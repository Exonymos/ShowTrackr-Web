(()=>{var x=!1,g;function y(){x=!0}function b(){x=!1}function k(e){clearTimeout(g);let s=e.target.dataset.largePoster,t=document.getElementById("poster-hover-tooltip");if(s&&t){let o=new Image;o.onload=()=>{t.innerHTML="",t.appendChild(o);let c=window.scrollX||window.pageXOffset,a=window.scrollY||window.pageYOffset,i=e.pageX+15,r=e.pageY+15,m=t.getBoundingClientRect(),w=window.innerWidth,I=window.innerHeight,p=Math.min(m.width||250,250),h=m.height||375;i+p>w+c&&(i=e.pageX-p-15),r+h>I+a&&(r=e.pageY-h-15),i<c&&(i=c+5),r<a&&(r=a+5),t.style.left=`${i}px`,t.style.top=`${r}px`,t.style.display="block"},o.onerror=()=>{console.error("Failed to load large poster image for tooltip."),t.style.display="none"},o.src=s,o.alt="Large Poster",o.style.maxWidth="250px",o.style.maxHeight="400px",o.style.borderRadius="0.25rem"}}function E(){g=setTimeout(()=>{let e=document.getElementById("poster-hover-tooltip");e&&(e.style.display="none",e.innerHTML="")},100)}document.addEventListener("mouseover",function(e){e.target.matches(".poster-image")&&k(e),e.target.closest("#poster-hover-tooltip")&&clearTimeout(g)});document.addEventListener("mouseout",function(e){if(e.target.matches(".poster-image")){let n=document.getElementById("poster-hover-tooltip");(!n||!n.contains(e.relatedTarget))&&E()}e.target.closest("#poster-hover-tooltip")&&!e.target.closest("#poster-hover-tooltip").contains(e.relatedTarget)&&E()});document.body.addEventListener("htmx:afterSwap",function(e){if(e.detail.target.id==="modal-content"){b();let o=e.detail.target.querySelector("form#item-form");if(o){o.querySelectorAll("input, textarea, select").forEach(i=>{i.addEventListener("input",y),i.addEventListener("change",y)});let c=o.querySelector('input[name="item_id"]'),a=document.getElementById("modal-title-static");a&&(c&&c.value?a.textContent="Edit Watchlist Item":a.textContent="Add New Watchlist Item")}}let s=e.detail.requestConfig.elt,t=s?s.closest("form#item-form"):null;if(t&&t.parentElement.parentElement.id==="modal-content"&&e.detail.xhr.status===200&&e.detail.xhr.getResponseHeader("X-Close-Modal")){let o=document.getElementById("add_item_modal");b(),o&&typeof o.close=="function"&&o.close()}});document.addEventListener("DOMContentLoaded",function(){function e(n){if((n.metaKey||n.ctrlKey)&&n.key==="k"){n.preventDefault();let s=document.getElementById("search-input");s&&s.focus()}}document.addEventListener("keydown",e),document.querySelectorAll(".flash-message").forEach(function(n){let s=n.dataset.message,t=n.dataset.category;t==="message"&&(t="info"),d(s,t),n.remove()})});var u=document.getElementById("feedback-form"),f=document.getElementById("feedback-submit-btn"),l=document.getElementById("feedback-status");if(u&&f){let e=u.dataset.feedbackUrl||document.body.dataset.feedbackUrl;u.addEventListener("submit",async n=>{if(n.preventDefault(),!e){d("Feedback submission URL is not configured.","error");return}let s=document.getElementById("feedback-text"),t=f.querySelector("span:not(.loading)"),o=f.querySelector(".loading");if(!s.value.trim()){d("Feedback cannot be empty.","warning"),s.focus();return}f.disabled=!0,t.classList.add("hidden"),o.classList.remove("hidden"),l&&(l.textContent="Submitting...");let a=new FormData(u),i=document.getElementById("feedback-send-info");a.set("sendInfo",i.checked),i.checked?a.set("userAgent",navigator.userAgent||"N/A"):a.delete("userAgent");try{let r=await fetch(e,{method:"POST",body:a});if(!r.ok)throw new Error(`HTTP error ${r.status}`);let m=await r.text();m.toLowerCase().includes("success")?(d("Feedback submitted successfully!","success"),u.reset(),l&&(l.textContent="")):(d(m||"Failed to submit feedback.","error"),l&&(l.textContent=m||"Submission failed."))}catch(r){console.error("Feedback submission error:",r),d(`Error submitting feedback: ${r.message}`,"error"),l&&(l.textContent="Error. Please try again.")}finally{f.disabled=!1,t.classList.remove("hidden"),o.classList.add("hidden")}})}function d(e,n="info"){let s=document.getElementById("toast-container")||T(),t="toast-"+Date.now(),o={success:"alert-success",error:"alert-error",warning:"alert-warning",info:"alert-info"}[n]||"alert-info",c=`
                <div id="${t}" class="alert ${o} shadow-lg text-sm py-2 px-4">
                    <span>${e}</span>
                </div>
            `;s.insertAdjacentHTML("beforeend",c),setTimeout(()=>{let a=document.getElementById(t);a&&(a.style.transition="opacity 0.5s ease-out",a.style.opacity="0",setTimeout(()=>a.remove(),500))},4e3)}function T(){let e=document.createElement("div");return e.id="toast-container",e.className="toast toast-bottom toast-end z-[99]",document.body.appendChild(e),e}document.body.addEventListener("htmx:afterRequest",function(e){let n=e.detail.xhr,s=document.getElementById("add_item_modal");n.status===200&&n.getResponseHeader("X-Close-Modal")&&s&&typeof s.close=="function"&&s.close();let t=n.getResponseHeader("X-HX-Alert"),o=n.getResponseHeader("X-HX-Alert-Type")||"info";t&&d(t,o)});document.body.addEventListener("htmx:beforeSwap",function(e){e.detail.xhr.status>=400&&e.detail.target.id==="form-feedback"&&(e.detail.serverResponse.includes("alert-error")?d("Please correct the errors in the form.","error"):(d("An unexpected error occurred.","error"),e.preventDefault()))});})();
